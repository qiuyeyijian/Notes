# MATLAB

## 背景知识

MATLAB语言为数学问题的计算机求解，特别是控制系统的仿真领域起到了巨大的推动作用。1978年美国New Mexico大学计算机科学系的主任**Cleve Moler教授**认为用当时最先进的**EISPACK和LINPACK**软件包求解线性代数问题过程过于繁琐，所以构思一个名为**MATLAB（Matrix Laboratory，矩阵实验室）**的交互式计算机语言。可以说，MATLAB语言是由计算机数学专家首创，但是由控制学界捧红的计算机语言，很大一部分都是面向自动控制和相关学科的。稍后出现的**Mathematica及Maple**等语言也应用广泛。

## 编程基础

### 保留的常数

| 常数                | 含义                                                         |
| ------------------- | ------------------------------------------------------------ |
| `eps`               | epsilon，机器的浮点数运算误差限。PC上eps的默认值为 $2.2204 \times 10^{-16} $，若某个量的绝对值小于eps，可以认为为0。 |
| `i和j`              | 若常量未被改写，则他们表示纯虚数$\sqrt{-1}$ 。               |
| `Inf或inf`          | 无穷大量                                                     |
| `NaN`               | 不定式（not a number），通常0/0、inf/inf、0*inf可得出NaN。   |
| `pi`                | 圆周率                                                       |
| `true和false`       | 逻辑变量                                                     |
| `lasterr和lastwarn` | 存放最新一次的错误和警告信息                                 |

**MATLAB的语句之间可以有逗号或者分号分隔，也可以直接换行开始下一条语句。**若语句末尾没有分号，则会直接显示执行结果。否则结果不会显示出来，需要手动打印。

### 显示格式设置

MATLAB使用`format`命令来设置显示格式，常用命令有

```matlab
format short;		% 设置显示格式为短型，小数点后显示4位有效数字
format long;		% 设置显示格式为长型，小数点后显示15位有效数字
```

| 参数      | 含义           |
| --------- | -------------- |
| `short`   | 短型           |
| `long`    | 长型           |
| `compact` | 紧凑型         |
| `loose`   | 宽松型（默认） |
| `rat`     | 有理型         |

> **注意：format命令并不改变结果，他改变的只是显示形式。**



### 设置工作目录

MATLAB默认的工作目录是程序安装路径的bin文件夹，该路径是只读的。为了方便，我们最好重新设置个工作目录，我并没有这MATLAB中找到相关设置选项，但是我们可以采用一种巧妙的方法：

由于MATLAB启动时候，会自动执行工作目录下的一个名为`startup.m`文件，所以我们可以在bin目录创建一个`startup.m`文件，输入下面的代码：

```matlab
cd('F:\WorkSpace\MATLAB')		% 切换到新的工作目录
!code .		% 执行dos命令，用vscode打开此工作目录(我喜欢在vscode中编写代码)

% 下面还可输入更多的命令，如果你希望一些工作在启动的时候就自动完成
```

另一种方法是在桌面创建一个MATLAB快捷图标，**鼠标右键 => 属性 => 起始位置**。在起始位置中填入你的工作目录就行。缺点是不能执行其他命令，对你来说够用的话，可以尝试。



## 常用数据结构

### 数值型数据

MATLAB最基本的数据结构是**双精度复数矩阵**。矩阵的的内容由**方括号**括起来的的内容表示。在方括号中，分号或者回车表示矩阵的换行，逗号或者空格用来分割同一行元素。MATLAB创建变量不需要提前声明。

```matlab
%创建一个3x3的矩阵，此处为了演示，故意逗号和空格混用，建议保持风格一致
a = [1 2 3; 4, 5, 6; 7, 8 9];

% 可以动态调整矩阵的维数，下面将a增加一行和一列
a = [a; [1, 2, 3], [1;2;3;4]]
```

MATLAB环境中定义了两个记号：`i和j`，效果相同，可以用来直接输入复数矩阵。需要注意，不建议单独使用`i或者j`，建议使用`1i或者sqrt(-1)`具体参考下面例子最后一个元素。

```matlab
% 此处为了演示，i和j混用，建议风格统一。单独出现i，前面要加系数1，或者使用sqrt(-1)
b = [1+9i, 2+8i; 3+7j, sqrt(-1); 5+5i, 1i]
```



### 符号型数据

MATLAB定义了符号型（symbolic）变量，用于区别常规的数值型变量，可以用于公式推导和数学问题的解析解法。

> 为什么需要符号性数据？举个简单例子，如果采用双精度存储`a = 1/3`，但是我们都知道`1/3`转换成`0.333333...`无论多少位，后面的3肯定会被截断，就产生了误差。但是符号性数据`sym(1/3)`始终是`1/3`，全称参与运算，所以不会产生误差

进行解析运算前，需要首先将采用的变量声明为符号变量，这需要`syms`命令实现。

```matlab
syms 变量名列表 变量集合
```

变量名列表：需要声明的变量列表，可以同时声明多个变量，中间只能以空格分隔，不能用逗号或其他符号。

| 常见变量集合 | 含义   |
| ------------ | ------ |
| `positive`   | 正数   |
| `integer`    | 整数   |
| `real`       | 实数   |
| `rational`   | 有理数 |

| 常见函数       | 含义                                                         |
| -------------- | ------------------------------------------------------------ |
| assumptions(x) | 返回符号变量x的类型                                          |
| x = symvar(f)  | 从符号表达式f中提取符号变量列表，赋值给x                     |
| vpa(a, n)      | 精度算法函数，将表达式或矩阵a，以有效数字n显示出来。n可以省略，默认32位十进制位数 |
| assume()       | 设置符号变量的属性                                           |
| assumeAlso()   | 进一步设置符号变量属性                                       |
| sym(a)         | 将a转换成符号变量                                            |

```matlab
syms x y real;		% 声明x，y为实数

assume(x >= -1);	% 设置符号变量属性
assumeAlso(x < 5);

assumptions(x);		% 读出符号变量的类型

vpa(pi, 105);		% 显示π的前105位
vpa(pi);			% 显示π的前32位

a = 123
a = sym(a);			% 将a转换成符号型变量
```



#### 任意符号型矩阵的生成

```matlab
B = sym('b%d%d', [3, 3]);		% 生成以b开头的，3x3矩阵
%{
[b11, b12, b13]
[b21, b22, b23]
[b31, b32, b33]
%}
```

#### 符号型函数

由`syms`声明，先声明自变量为符号变量，再声明函数F(x)和G(x, y, z, u)

```matlab
syms x y z u F(x) G(x, y, z, u)
```



### 整型与逻辑变量

MATLAB提供了一系列的整型和无符号整型的数据类型：`int8(), int16(), int32()`、`uint8(), uint16(), uint32()`等。

MATLAB还提供了逻辑性数据结构，只能取0和1

```matlab
a = uint8(123);		% 设置a为无符号8位整型
b = logical(1);		% 设置b为逻辑1
```



### 数据结构类型识别

| 数据结构类型    | 含义                             |
| --------------- | -------------------------------- |
| double          | 双精度                           |
| single          | 单精度                           |
| int*            | 整型，星号代表位数，如16位       |
| uint*           | 无符号整型，星号代表位数，如16位 |
| char            | 字符型、字符串                   |
| logical         | 逻辑型                           |
| struct          | 结构体                           |
| cell            | 单元数组（元胞数组）             |
| function_handle | 函数句柄                         |

```matlab
key = class(a);		% 将a的数据结构类型赋值给key
key = isa(a, 'double');		% 判断a是否为double
```



### 矩阵维数识别

```matlab
len = length(A);	% 矩阵A行数和列数最大值
lenRow = size(A, 1);	% 矩阵行数
lenCol = size(A, 2);	% 矩阵列数
```

MATLAB提供了`reshape()`函数来重新调整矩阵维数，其方法是，将A矩阵先按列展开生成列向量，将其截为长度为n的列向量，总共可以截m段。这样就可以将这些列向量依次排列，重新构造出矩阵B。MATLAB会自动判断用户输入的行列数乘积个数是否与原来一致。

```matlab
B = reshape(a, n, m);
% 或者
B = reshape(a, [n, m])
```



### 图形界面编辑

MATLAB的`openvar()`函数会打开一个数据编辑图形界面，允许用户可视化编辑变量，**传输的参数是变量名的字符串形式。**

```matlab
openvar('var');
```

### 冒号表达式

冒号表达式的格式为 `V = s1:s2:s3`，该函数生成一个行向量V。

* s1：向量起始值
* s2：步距
* s3：最大值，元素可以等于最大值，但不能超过最大值

**若省略s2，则默认步距值为1。**

```matlab
v1 = 0:0.2:pi;	%[0, 0.2, 0.4,..., 3]，因为下一个取值3.2大于pi，所以只能取到3
v2 = 0:-0.1:pi;	%[]	1x0的空矩阵
v3 = 0:pi;	% [0, 1, 2, 3]
v4 = 3:-1:0;	%[3, 2, 1, 0]

a = 13:13:1000		% 找到1000以内能被13整除的所有整数
```



### 等间距行向量生成

**线性等间距点的生成：** `v = linspace(n1, n2, N)`，起始值为n1，终止值为n2，向量点数为N（默认50）。这样的向量又称为线性等间距向量

**对数等间距点的生成：** `w = logspace(n1, n2, N)`，起始值为lgn1（以10为底），终止值为lgn2，向量点数为N







```matlab
disp('Hello, World');
```

## 数组及运算

```matlab
b = [1 2 3 4];		%创建一维行向量
c = [9;2;-1];		%创建一维列向量
d = [1 4 7; 2 5 8; 3 6 9];	% 创建二维数组
```



## 控制语句

### 循环结构

表达式1的值为循环变量的初值，表达式2的值为步长，表达式3的值为循环变量的终值。**步长为1时，表达式2可以省略。**

```matlab
for 循环变量 = 表达式1: 表达式2: 表达式3
	循环语句
end
```

while语句执行过程：若条件成立，则执行循环体语句，执行后在判断条件是否成立。如果成立，则继续执行循环体语句，如果不成立则跳出循环。

```matlab
while (条件)
	循环体语句
end
```



```matlab
if 条件
	语句组1
elseif 条件
	语句组2
else
	语句组3
end
```

```matlab
switch 表达式
	case 表达式1
		语句组1
	case 表达式2
		语句组2
    case 表达式3
		语句组3
	otherwise
		语句组n
end
```







## 参考

1. 薛定宇：MATLAB程序设计—卷1