# 排序





## 外部排序

### 存储器与缓冲区

外存设备大体可以分为两类：一类是顺序存取设备，如磁带；另一类是直接存取设备，如磁盘。所以外排序有分为磁带排序和磁盘排序。我们主要讨论磁盘排序。

为了实现磁盘的读写操作，在内存中需要开辟一些区域，用以存放需要从磁盘读入的信息，或存放需要写出的信息。这些内存区域成为缓冲区，存入缓冲区的信息称为缓冲信息。

**一个缓冲区的大小应与操作系统一次读写的块的大小相适应。如果不匹配就会造成空间浪费。**



### 基于磁盘的外排序

对于以文件形式存放于磁盘存储器上的数据进行外排序是，一般使用**归并排序**的方法。它的特点是对所有待排序的数据元素顺序存取，顺序比较，其他排序方法没有这个特点。

外排序主要分为两个阶段：

1. 生成初始归并段：建立为内存缓冲区，根据缓冲区大小将输入文件划分为若干段， 分段读入内存。用某种内排序方法，如堆排序，对各段进行排序。这些经过排序的段叫做**初始归并段**（又称初始顺串，runs）。将这些初始归并段写到过个外存文件上。
2. 多路归并：对第一阶段产生的初始归并段进行多遍归并，使得有序的归并段逐渐扩大，最后在外存上形成整个文件的单一归并段，至此完成了对这个文件的外排序。

归纳起来，影响磁盘排序时间性能的主要有两个原因：

1. 读写记录次数
2. 关键字比较次数

> 不同于内排序，磁盘排序中元素的移动次数相对于上述两个因素可以忽略，，所以一般不考虑元素移动的开销。

所以接下来要介绍的三个算法均是为了减少上述两个因素的影响而设计的。

* **败者树：减少关键字的比较次数**
* **置换选择排序：减少初始归并段的个数**
* **最佳归并树：给出最佳归并方案，减少读磁盘次数**



### 败者树

败者树（tree of loser）是一棵完全二叉树（可将大根堆看成胜者树），其中叶子节点存储参与归并的记录，分支节点存放关键字对应的段号。所谓败者就是两个记录比较时关键字较大者，胜者是两个关键字比较时关键字较小者。

首先介绍败者树，败者树应该算是另外两个算法的基石，因为败者树可以减少这个算法的关键字比较次数，从而提高算法效率。



### 置换-选择排序





### 多路平衡归并

多路平衡归并，又称为m路平衡归并：每一趟从r个归并段中得到$\lceil  \frac r m \rceil$个归并段。如果说r不能被m整除，则多余的归并段参与下趟归并。

**做m路平衡归并时，如果有r个初始归并段，则需要归并的趟数为$\lceil  log_m r \rceil$。**



### 最佳归并树



